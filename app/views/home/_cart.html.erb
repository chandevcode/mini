<div class="lg:col-span-1">
  <div class="card bg-base-100 shadow-xl sticky top-4 
              max-h-[calc(100vh-2rem)] md:max-h-[80vh] 
              overflow-y-auto
              [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]">
    <div class="card-body">
      <h2 class="text-lg font-bold mb-2">Cart</h2>

      <% if session[:cart].present? %>
        <!-- Cart Items Section (Scrollable) -->
        <div class="space-y-4 flex-1 overflow-y-auto">
          <ul class="space-y-4">
            <% session[:cart].each do |id, item| %>
              <li class="flex items-center gap-4">
                <%= image_tag "coffee.jpg", alt: "Coffee", class: "size-16 rounded-sm object-cover" %>

                <div>
                  <h2 class="text-md font-bold text-gray-900"><%= item["name"] %></h2>
                  <h2 class="mt-0.5 space-y-px text-md text-gray-800">
                    Rp <%= item["price"] * item["qty"] %> 
                  </h2>
                </div>

                <div class="flex flex-1 items-center justify-end gap-2">
                  <form>
                    <label for="Line1Qty" class="sr-only">Quantity</label>
                    <input type="number" min="1" value="<%= item["qty"] %>" id="Line1Qty" 
                           class="h-8 w-12 rounded-sm border-gray-200 bg-gray-50 p-0 text-center text-xs text-gray-600 
                                  [-moz-appearance:_textfield] focus:outline-hidden 
                                  [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none 
                                  [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none">
                  </form>

                  <%= button_to remove_cart_path(id), method: :delete, class: "text-gray-600 transition hover:text-red-600" do %>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"></path>
                    </svg>
                  <% end %>
                </div>
              </li> 
            <% end %>
          </ul>
        </div>

        <!-- Sticky Checkout Section -->
        <%= form_with url: checkout_path, method: :post, class: "w-full mt-4 pt-4 sticky bottom-0 bg-base-100" do |f| %>
          <!-- Table Number Input -->
          <div class="mb-4">
            <h3 class="font-semibold mb-2">Table Number</h3>
            <%= f.number_field :table_number, 
              min: 1, 
              value: 1, 
              required: true,
              class: "input input-bordered w-full", 
              placeholder: "Enter table number" 
            %>
          </div>

          <!-- Payment Method Selection -->
          <div class="mb-4">
            <h3 class="font-semibold mb-2">Payment Method</h3>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <%= f.radio_button :payment_method, "cash", class: "radio radio-primary", checked: true %>
                <span class="label-text">Cash</span>
              </label>

              <label class="flex items-center gap-2 cursor-pointer">
                <%= f.radio_button :payment_method, "qris", class: "radio radio-primary" %>
                <span class="label-text">QRIS</span>
              </label>

              <label class="flex items-center gap-2 cursor-pointer">
                <%= f.radio_button :payment_method, "transfer", class: "radio radio-primary" %>
                <span class="label-text">Transfer</span>
              </label>
            </div>
          </div>

          <div class="mb-4">
            <h3 class="font-semibold mb-2">Dine In / Take Away</h3>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <%= f.radio_button :order_type, "dine_in", class: "radio radio-primary", checked: true %>
                <span class="label-text">Dine In</span>
              </label>

              <label class="flex items-center gap-2 cursor-pointer">
                <%= f.radio_button :order_type, "take_away", class: "radio radio-primary" %>
                <span class="label-text">Take Away</span>
              </label>
            </div>
          </div>

          <div class="mb-4">
            <h3 class="font-semibold mb-2">Total</h3>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <h1 class="text-lg font-bold"> <%= format_cart_total %></h1>
              </label>
            </div>
          </div>

          <%= f.submit "Checkout", class: "btn btn-primary w-full" %>
        <% end %>                      

      <% else %>
        <p class="opacity-70">Cart empty</p>
      <% end %>
    </div>
  </div>
</div>
